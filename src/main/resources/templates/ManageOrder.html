<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Trang quản lý sản phẩm dành cho người bán" />
    <meta name="keywords" content="admin, dashboard, vendor, product management" />

    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <title>Quản lý Sản Phẩm</title>

    <style>
      .custom-navbar {
        padding-top: 20px;
        padding-bottom: 20px;
      }

      .custom-navbar .navbar-brand {
        font-size: 32px;
        font-weight: 600;
      }

      .custom-navbar .navbar-brand span {
        color: #3b5d50;
      }

      .custom-navbar-nav .nav-link {
        font-weight: 500;
        color: #ffffff !important;
        opacity: 0.5;
        transition: .3s all ease;
      }

      .custom-navbar-nav .nav-link:hover,
      .custom-navbar-nav .nav-link.active {
        opacity: 1;
      }

      .dashboard-content {
        padding: 2rem;
      }

      /* Các nút trạng thái */
      .product-status-btn {
        font-weight: 600;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 25px;
        display: flex;
        align-items: center;
        transition: 0.3s ease;
        margin-right: 10px;
      }

      .product-status-btn i {
        font-size: 18px;
      }

      .product-status-btn:hover {
        transform: translateY(-2px);
      }

      .product-status-btn:focus {
        outline: none;
      }

      .product-status-btn i {
        margin-right: 8px;
      }

      /* Màu sắc các nút */
      .btn-tat-ca { border: 1px solid #3b5d50; color: #3b5d50; }
      .btn-chao-xac-nhan { border: 1px solid #ff9800; color: #ff9800; }
      .btn-dang-giao { border: 1px solid #007bff; color: #007bff; }
      .btn-da-giao { border: 1px solid #28a745; color: #28a745; }
      .btn-huy { border: 1px solid #dc3545; color: #dc3545; }
      .btn-tra-hang { border: 1px solid #17a2b8; color: #17a2b8; }
      
      /* Điều chỉnh kích thước cho các nút Chi Tiết và Xác Nhận */
	.btn-group .btn {
	    padding: 8px 16px; /* Giảm padding để nút nhỏ lại */
	    font-size: 14px; /* Giảm kích thước chữ */
	    border-radius: 20px; /* Sử dụng border-radius nhỏ hơn để tạo vẻ mềm mại */
	    margin-right: 10px; 
	}
	
	/* Nút Chi Tiết */
	.btn-detail {
	    background-color: #17a2b8;
	    color: white;
	    border: 1px solid #17a2b8;
	}
	
	.btn-detail i {
	    font-size: 14px; /* Giảm kích thước icon */
	    margin-right: 6px; /* Giảm khoảng cách giữa icon và chữ */
	}
	
	/* Hiệu ứng hover và focus cho Nút Chi Tiết */
	.btn-detail:hover {
	    background-color: #138496;
	    border-color: #138496;
	    transform: translateY(-2px); /* Tạo hiệu ứng nâng lên */
	}
	
	/* Nút Xác Nhận */
	.btn-confirm {
	    background-color: #28a745;
	    color: white;
	    border: 1px solid #28a745;
	}
	
	.btn-confirm i {
	    font-size: 14px; /* Giảm kích thước icon */
	    margin-right: 6px; /* Giảm khoảng cách giữa icon và chữ */
	}
	
	/* Hiệu ứng hover và focus cho Nút Xác Nhận */
	.btn-confirm:hover {
	    background-color: #218838;
	    border-color: #218838;
	    transform: translateY(-2px); /* Tạo hiệu ứng nâng lên */
	}
	
	/* Điều chỉnh Responsive */
	@media (max-width: 768px) {
	    .btn-group {
	        flex-direction: column;
	        gap: 10px; /* Khoảng cách khi thu nhỏ màn hình */
	    }
	
	    .btn {
	        width: 100%;
	    }
	}
      
    </style>
  </head>

  <body>
    <!-- Start Header/Navigation -->
    <nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark" aria-label="Vendor product management navigation bar">
      <div class="container">
        <a class="navbar-brand" href="index.html">Vendor Management<span>.</span></a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsVendor" aria-controls="navbarsVendor" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsVendor">
          <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="fas fa-home me-2"></i>Trang Chủ</a>
            </li>
            
            
            <li class="nav-item active">
              <a class="nav-link" href="#"><i class="fas fa-cogs me-2"></i>Quản lý đơn hàng</a>
            </li>
            
            </li>
	        <!-- Nút Thông Báo -->
	        <li class="nav-item">
	          <a class="nav-link" href="#" id="notificationButton" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Thông báo">
	            <i class="fas fa-bell me-2"></i>
	            <span class="badge bg-danger">3</span> <!-- Số lượng thông báo -->
	          </a>
	        </li>
	        
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Header/Navigation -->

    <!-- Start Product Management Content -->
  	<div class="dashboard-content">
  	
	  <div class="container">
		    <h2>Quản lý đơn hàng</h2>
		
		    <!-- Filter Buttons -->
		    <div class="d-flex justify-content-start mb-4">
		      <a href="/vendor/orders?status=" class="btn product-status-btn btn-tat-ca">
		        <i class="fas fa-list me-2"></i>Tất Cả
		      </a>
		      <a href="/vendor/orders?status=pending" class="btn product-status-btn btn-chao-xac-nhan">
		        <i class="fas fa-clock me-2"></i>Chờ Xác Nhận
		      </a>
		      <a href="/vendor/orders?status=shipping" class="btn product-status-btn btn-dang-giao">
		        <i class="fas fa-shipping-fast me-2"></i>Đang Giao
		      </a>
		      <a href="/vendor/orders?status=delivered" class="btn product-status-btn btn-da-giao">
		        <i class="fas fa-check-circle me-2"></i>Đã Giao
		      </a>
		      <a href="/vendor/orders?status=canceled" class="btn product-status-btn btn-huy">
		        <i class="fas fa-ban me-2"></i>Hủy
		      </a>
		      <a href="/vendor/orders?status=returned" class="btn product-status-btn btn-tra-hang">
		        <i class="fas fa-undo me-2"></i>Trả Hàng/Hoàn Tiền
		      </a>
	    </div>

    <!-- Hiển thị danh sách đơn hàng -->
	<div th:if="${orders != null and !orders.isEmpty()}">
		  <div class="list-group">
		    <!-- Lặp qua danh sách đơn hàng -->
		    <div th:each="order, iterStat : ${orders}" class="list-group-item">
		      <h5>Mã đơn hàng: <span th:text="${order.id}"></span></h5>
	              <p><strong>Khách hàng:</strong> <span th:text="${order.user.username}"></span></p>
	              <p><strong>Ngày tạo:</strong> <span th:text="${formattedDates[iterStat.index]}"></span></p>
	              <p><strong>Tổng tiền:</strong> <span th:text="${order.totalAmount}"></span> VND</p>
	              
	              <!-- Hiển thị địa chỉ mặc định -->
	              <p><strong>Địa chỉ:</strong>
	              <span th:if="${defaultAddresses != null and defaultAddresses[iterStat.index] != null}">
				    <span th:text="${defaultAddresses[iterStat.index].streetAddress}"></span>, 
				    <span th:text="${defaultAddresses[iterStat.index].city}"></span>, 
				    <span th:text="${defaultAddresses[iterStat.index].state}"></span>, 
				    <span th:text="${defaultAddresses[iterStat.index].country}"></span>
				</span>
	              
	              <p><strong>Trạng thái:</strong> <span th:text="${order.status}"></span></p>
	              <p><strong>Số điện thoại:</strong> <span th:text="${phoneNumbers[iterStat.index]}"></span></p>  <!-- Hiển thị số điện thoại -->
		
		      <!-- Nút Chi Tiết luôn hiển thị -->
		      <div class="btn-group" role="group" aria-label="Order Actions">
		        <a th:href="@{/vendor/order/{id}/detail(id=${order.id})}" class="btn btn-primary">
		          <i class="fas fa-info-circle"></i> Chi Tiết
		        </a>
		
		        <!-- Nút Xác Nhận, chỉ hiển thị nếu trạng thái là 'Chờ xác nhận' -->
			<a th:if="${order.status == 'Chờ xác nhận'}"
			   href="javascript:void(0);"
			   class="btn btn-success"
			   th:onclick="|confirmOrder([[${order.id}]])|">
			    <i class="fas fa-check-circle"></i> Xác Nhận
			</a>
	
	
		
		        <!-- Nút Đã Giao, chỉ hiển thị nếu trạng thái là 'Đang giao' -->
		        <a th:if="${order.status == 'Đang giao'}" 
		           th:href="@{/vendor/order/{id}/delivered(id=${order.id})}" 
		           class="btn btn-info">
		          <i class="fas fa-shipping-fast"></i> Đã Giao
		        </a>
		
		        <!-- Nút Hoàn Thành, chỉ hiển thị nếu trạng thái là 'Đã giao' -->
		        <a th:if="${order.status == 'Đã giao'}" 
		           th:href="@{/vendor/order/{id}/complete(id=${order.id})}" 
		           class="btn btn-success">
		          <i class="fas fa-check-circle"></i> Hoàn Thành
		        </a>
		      </div>
		    </div>
		  </div> 
</div>
    
    </div>

    <!-- Nếu không có đơn hàng nào -->
    <div th:if="${orders == null or orders.isEmpty()}">
      <p>Không có đơn hàng nào với trạng thái đã chọn.</p>
    </div>
  </div>
  	
    <!-- Bootstrap JS, Popper.js, and jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <!-- Xử lý trạng thái order từ chờ xác nhận thành chờ giao -->
    <script>
    <!-- Xử lý trạng thái order từ chờ xác nhận thành chờ giao -->
	    function confirmOrder(orderId) {
	        // Gửi yêu cầu AJAX đến server
	        fetch(`/vendor/order/confirm/${orderId}`, {
	            method: 'POST',  // Phương thức HTTP POST
	            headers: {
	                'Content-Type': 'application/json', // Đảm bảo gửi dữ liệu đúng định dạng
	            },
	            body: JSON.stringify({ orderId: orderId }) // Gửi ID đơn hàng trong thân request
	        })
	        .then(response => response.json())  // Chờ phản hồi từ server
	        .then(data => {
	            if (data.success) {
	                // Nếu thành công, thông báo cho người dùng
	                alert('Đơn hàng đã được xác nhận thành công!');
	                // Cập nhật giao diện (có thể refresh hoặc cập nhật trạng thái đơn hàng)
	                location.reload(); // Reload lại trang để cập nhật trạng thái đơn hàng
	            } else {
	                alert('Có lỗi xảy ra khi xác nhận đơn hàng!');
	            }
	        })
	        .catch(error => {
	            console.error('Lỗi:', error);
	            alert('Có lỗi xảy ra khi xác nhận đơn hàng!');
	        });
	    }
	</script>
	
	<script>
	  // Kích hoạt tooltip cho tất cả các phần tử có thuộc tính data-bs-toggle="tooltip"
	  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
	  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
	    return new bootstrap.Tooltip(tooltipTriggerEl);
	  });
	</script>
  </body>
</html>
